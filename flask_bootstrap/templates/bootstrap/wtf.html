{% macro form_errors(form, hiddens=True) %}
  {%- if form.errors %}
    {%- for fieldname, errors in form.errors.iteritems() %}
      {%- if bootstrap_is_hidden_field(form[fieldname]) and hiddens or
             bootstrap_is_hidden_field(form[fieldname]) and hiddens != 'only' %}
        {%- for error in errors %}
          <p class="error">{{error}}</p>
        {%- endfor %}
      {%- endif %}
    {%- endfor %}
  {%- endif %}
{%- endmacro %}

{% macro form_field(field, form_type="basic") %}
{% if field.widget.input_type == 'checkbox' %}
  <div class="checkbox">
    <label>
      {{field()|safe}} {{field.label.text|safe}}
    </label>
  </div>
{%- elif field.type == 'RadioField' -%}
  {% for item in field -%}
    <div class="radio">
      <label>
        {{item|safe}} {{item.label.text|safe}}
      </label>
    </div>
  {% endfor %}
{% else -%}
  <div class="form-group {% if field.errors %} has-error{% endif %}">
    {{field.label(class="sr-only" if form_type == "inline" else "control-label")|safe}}
    {# note: A cleaner solution would be rendering depending on the widget,
       this is just a hack for now, until I can think of something better #}

      {%- if form_type == "inline" %}
        {{field(class="form-control", placeholder=field.description, **kwargs)|safe}}
      {%- else -%}
        {{field(class="form-control", **kwargs)|safe}}
      {%- endif %}
    {%- if form_type != "inline" %}
      {%- if field.errors %}
        {%- for error in field.errors %}
          <p class="help-block">{{error}}</p>
        {%- endfor %}
      {%- elif field.description -%}
        <p class="help-block">{{field.description|safe}}</p>
      {%- endif %}
    {% endif %}
  </div>
{% endif %}
{% endmacro %}

{# valid form types are "basic", "inline" and "horizontal" #}
{% macro quick_form(form,
                    action=".",
                    method="post",
                    extra_classes=None,
                    role="form",
                    form_type="basic",
                    buttons = [('submit', 'primary', 'Submit')],
                    enctype=None) %}
<form
  {%- if action %} action="{{action}}"{% endif -%}
  {%- if method %} method="{{method}}"{% endif -%}
  class="form
    {%- if extra_classes %} {{extra_classes}}{% endif -%}
    {%- if form_type == "horizontal" %} form-horizontal
    {%- elif form_type == "inline" %} form-inline
    {%- endif -%}
  "
  {%- if enctype %} enctype="{{enctype}}"{% endif -%}
  {%- if role %} role="{{role}}"{% endif -%}
  >
  {{ form.hidden_tag() }}
  {{ form_errors(form, hiddens='only') }}

  {%- for field in form %}
    {% if not bootstrap_is_hidden_field(field) -%}
      {{ form_field(field, form_type=form_type) }}
    {%- endif %}
  {%- endfor %}

</form>
{%- endmacro %}
